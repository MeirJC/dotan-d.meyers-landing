---
import Layout from "../layouts/Layout.astro";
import PageHeader from "@components/PageHeader.astro";
import { getCollection, type CollectionEntry } from "astro:content";
import SEOHead from "@components/SEOHead.astro";
import { siteConfig } from "../seo/seoData";

const pageTitle = "בלוג מקצועי - מאמרים בנושאי איטום ובדק בית";
const pageDescription =
  "מאמרים מקצועיים בנושאי איטום, בדק בית וציפויי רצפות מאת דותן מאיר. טיפים, מדריכים ומידע מקצועי לבעלי נכסים, קבלנים ויזמים";

// Get all blog posts (excluding drafts in production)
const posts = (
  await getCollection("blog", ({ data }) => {
    return import.meta.env.PROD ? !data.draft : true;
  })
).sort(
  (a: CollectionEntry<"blog">, b: CollectionEntry<"blog">) =>
    b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);
---

<Layout title={pageTitle} description={pageDescription}>
  <SEOHead
    slot="head"
    title={pageTitle}
    description={pageDescription}
    canonical={`${siteConfig.url}/blog`}
    pageType="blog"
    breadcrumbs={[
      { name: "ראשי", url: siteConfig.url },
      { name: "בלוג", url: `${siteConfig.url}/blog` }
    ]}
  />

  <PageHeader title="בלוג מקצועי" description="מידע וטיפים מקצועיים בנושאי איטום ובדק בית" />

  <section class="bg-background py-12">
    <div class="container mx-auto px-4">
      <div class="mx-auto max-w-4xl">
        <ul class="grid auto-rows-fr gap-8 md:grid-cols-2">
          {
            posts.map((post) => (
              <li class="flex">
                <article class="border-border bg-surface hover:border-border-hover flex h-full w-full flex-col overflow-hidden rounded-xl border shadow-lg transition-all duration-300 hover:shadow-xl">
                  {post.data.heroImage && (
                    <img
                      src={post.data.heroImage}
                      alt={post.data.heroImageAlt || post.data.title}
                      class="aspect-video w-full object-cover"
                      loading="lazy"
                    />
                  )}
                  <div class="flex flex-1 flex-col p-6">
                    <div class="mb-4 flex items-center justify-between">
                      <time
                        class="text-primary-light text-sm"
                        datetime={post.data.pubDate.toISOString()}>
                        {post.data.pubDate.toLocaleDateString("he-IL")}
                      </time>
                      {post.data.category && (
                        <span class="bg-primary text-primary-foreground rounded-full px-3 py-1 text-xs font-medium">
                          {post.data.category}
                        </span>
                      )}
                    </div>
                    <h2 class="text-text-primary mb-2 text-xl font-bold">
                      <a
                        href={`/blog/${post.slug}`}
                        class="hover:text-primary-light transition-colors">
                        {post.data.title}
                      </a>
                    </h2>
                    <p class="text-text-secondary mb-4 flex-1">{post.data.description}</p>
                    <a
                      href={`/blog/${post.slug}`}
                      class="text-primary-light hover:text-primary mt-auto inline-flex items-center gap-2 transition-colors">
                      קרא עוד
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-5 w-5"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        aria-hidden="true">
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M15 19l-7-7 7-7"
                        />
                      </svg>
                    </a>
                  </div>
                </article>
              </li>
            ))
          }
        </ul>
      </div>
    </div>
  </section>
</Layout>
