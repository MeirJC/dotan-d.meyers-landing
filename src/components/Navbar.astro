<header
  class="border-border bg-background/95 fixed top-0 right-0 left-0 z-50 border-b backdrop-blur-sm">
  <div class="container mx-auto px-4">
    <div class="flex h-16 items-center justify-between">
      <a href="/" class="text-text-primary text-2xl font-bold md:text-3xl">D.Meyer's</a>

      <div class="hidden items-center gap-8 md:flex">
        <nav class="flex items-center gap-6" aria-label="ניווט ראשי">
          <a
            href="/"
            class="text-text-secondary hover:text-text-primary transition-colors duration-200"
            >ראשי</a
          >
          <a
            href="/projects"
            class="text-text-secondary hover:text-text-primary transition-colors duration-200"
            >פרויקטים</a
          >
          <a
            href="/blog"
            class="text-text-secondary hover:text-text-primary transition-colors duration-200"
            >מאמרים</a
          >
          <a
            href="/about"
            class="text-text-secondary hover:text-text-primary transition-colors duration-200"
            >אודות</a
          >
        </nav>

        <div class="flex items-center gap-3">
          <!-- Theme Toggle Button -->
          <button
            id="theme-toggle"
            type="button"
            class="border-border bg-surface text-text-secondary hover:bg-surface-hover hover:text-text-primary focus-visible:ring-ring flex h-9 w-9 items-center justify-center rounded-lg border transition-colors focus:outline-none focus-visible:ring-2"
            aria-label="החלף ערכת נושא">
            <!-- Sun icon (shown in dark mode) -->
            <svg
              id="theme-icon-light"
              class="hidden h-5 w-5"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
              stroke-width="2"
              aria-hidden="true">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"
              ></path>
            </svg>
            <!-- Moon icon (shown in light mode) -->
            <svg
              id="theme-icon-dark"
              class="hidden h-5 w-5"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
              stroke-width="2"
              aria-hidden="true">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"
              ></path>
            </svg>
          </button>

          <a
            href="/contact"
            class="bg-primary text-primary-foreground hover:bg-primary-hover focus-visible:ring-ring inline-flex items-center rounded-lg px-4 py-2 font-medium transition-colors focus:outline-none focus-visible:ring-2">
            צור קשר
          </a>
        </div>
      </div>

      <!-- Mobile menu button -->
      <div class="flex items-center gap-2 md:hidden">
        <!-- Theme Toggle Button (Mobile) -->
        <button
          id="theme-toggle-mobile"
          type="button"
          class="border-border bg-surface text-text-secondary hover:bg-surface-hover hover:text-text-primary flex h-9 w-9 items-center justify-center rounded-lg border transition-colors"
          aria-label="החלף ערכת נושא">
          <svg
            id="theme-icon-light-mobile"
            class="hidden h-5 w-5"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            stroke-width="2"
            aria-hidden="true">
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"
            ></path>
          </svg>
          <svg
            id="theme-icon-dark-mobile"
            class="hidden h-5 w-5"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            stroke-width="2"
            aria-hidden="true">
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"
            ></path>
          </svg>
        </button>

        <!-- Animated Hamburger Button -->
        <button
          id="mobile-menu-button"
          class="group text-text-secondary hover:bg-surface hover:text-text-primary focus-visible:ring-ring relative flex h-10 w-10 items-center justify-center rounded-lg transition-colors focus:outline-none focus-visible:ring-2"
          aria-label="פתח תפריט ניווט"
          aria-expanded="false"
          aria-controls="mobile-menu">
          <div class="flex h-5 w-6 flex-col items-center justify-center">
            <span
              class="hamburger-line absolute h-0.5 w-6 rounded-full bg-current transition-all duration-300 ease-in-out"
              style="transform: translateY(-8px)"></span>
            <span
              class="hamburger-line absolute h-0.5 w-6 rounded-full bg-current transition-all duration-300 ease-in-out"
            ></span>
            <span
              class="hamburger-line absolute h-0.5 w-6 rounded-full bg-current transition-all duration-300 ease-in-out"
              style="transform: translateY(8px)"></span>
          </div>
        </button>
      </div>
    </div>
  </div>

  <!-- Mobile Menu Overlay -->
  <div
    id="mobile-menu-overlay"
    class="bg-background/80 pointer-events-none fixed inset-0 top-16 z-40 opacity-0 backdrop-blur-sm transition-opacity duration-300 md:hidden"
    aria-hidden="true">
  </div>

  <!-- Mobile menu -->
  <div
    id="mobile-menu"
    class="border-border bg-surface invisible fixed top-16 right-0 left-0 z-50 max-h-[calc(100vh-4rem)] -translate-y-2 overflow-y-auto border-b opacity-0 shadow-xl transition-all duration-300 ease-out md:hidden"
    role="navigation"
    aria-label="תפריט נייד">
    <div class="container mx-auto px-4 py-6">
      <nav class="flex flex-col space-y-1">
        <a
          href="/"
          class="mobile-nav-link text-text-secondary hover:bg-surface-hover hover:text-text-primary translate-x-4 rounded-lg px-4 py-3 text-lg font-medium opacity-0 transition-all duration-200">
          <span class="flex items-center gap-3">
            <svg
              class="h-5 w-5"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
              stroke-width="2">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"
              ></path>
            </svg>
            ראשי
          </span>
        </a>
        <a
          href="/projects"
          class="mobile-nav-link text-text-secondary hover:bg-surface-hover hover:text-text-primary translate-x-4 rounded-lg px-4 py-3 text-lg font-medium opacity-0 transition-all duration-200">
          <span class="flex items-center gap-3">
            <svg
              class="h-5 w-5"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
              stroke-width="2">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"
              ></path>
            </svg>
            פרויקטים
          </span>
        </a>
        <a
          href="/blog"
          class="mobile-nav-link text-text-secondary hover:bg-surface-hover hover:text-text-primary translate-x-4 rounded-lg px-4 py-3 text-lg font-medium opacity-0 transition-all duration-200">
          <span class="flex items-center gap-3">
            <svg
              class="h-5 w-5"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
              stroke-width="2">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"
              ></path>
            </svg>
            מאמרים
          </span>
        </a>
        <a
          href="/about"
          class="mobile-nav-link text-text-secondary hover:bg-surface-hover hover:text-text-primary translate-x-4 rounded-lg px-4 py-3 text-lg font-medium opacity-0 transition-all duration-200">
          <span class="flex items-center gap-3">
            <svg
              class="h-5 w-5"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
              stroke-width="2">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
            </svg>
            אודות
          </span>
        </a>

        <div class="border-border my-4 border-t"></div>

        <a
          href="/contact"
          class="mobile-nav-link bg-primary text-primary-foreground hover:bg-primary-hover translate-x-4 rounded-lg px-4 py-3 text-center text-lg font-medium opacity-0 transition-all duration-200">
          <span class="flex items-center justify-center gap-3">
            <svg
              class="h-5 w-5"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
              stroke-width="2">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
              ></path>
            </svg>
            צור קשר
          </span>
        </a>
      </nav>
    </div>
  </div>
</header>

<script>
  // Theme Toggle
  function initTheme() {
    const html = document.documentElement;
    const themeToggle = document.getElementById("theme-toggle");
    const themeToggleMobile = document.getElementById("theme-toggle-mobile");
    const lightIcon = document.getElementById("theme-icon-light");
    const darkIcon = document.getElementById("theme-icon-dark");
    const lightIconMobile = document.getElementById("theme-icon-light-mobile");
    const darkIconMobile = document.getElementById("theme-icon-dark-mobile");

    // Get saved theme or default to dark
    const savedTheme = localStorage.getItem("theme") || "dark";

    function setTheme(theme: string) {
      if (theme === "light") {
        html.classList.remove("dark");
        html.classList.add("light");
        // Show moon icon (to switch to dark)
        lightIcon?.classList.add("hidden");
        darkIcon?.classList.remove("hidden");
        lightIconMobile?.classList.add("hidden");
        darkIconMobile?.classList.remove("hidden");
      } else {
        html.classList.remove("light");
        html.classList.add("dark");
        // Show sun icon (to switch to light)
        lightIcon?.classList.remove("hidden");
        darkIcon?.classList.add("hidden");
        lightIconMobile?.classList.remove("hidden");
        darkIconMobile?.classList.add("hidden");
      }
      localStorage.setItem("theme", theme);
    }

    function toggleTheme() {
      const currentTheme = html.classList.contains("light") ? "light" : "dark";
      const newTheme = currentTheme === "dark" ? "light" : "dark";
      setTheme(newTheme);
    }

    // Initialize theme
    setTheme(savedTheme);

    // Add event listeners
    themeToggle?.addEventListener("click", toggleTheme);
    themeToggleMobile?.addEventListener("click", toggleTheme);
  }

  // Mobile menu toggle with animations
  function initMobileMenu() {
    const mobileMenuButton = document.getElementById("mobile-menu-button");
    const mobileMenu = document.getElementById("mobile-menu");
    const mobileMenuOverlay = document.getElementById("mobile-menu-overlay");

    if (!mobileMenuButton || !mobileMenu || !mobileMenuOverlay) return;

    // After guard clause, these are guaranteed non-null
    const menuButton = mobileMenuButton;
    const menu = mobileMenu;
    const overlay = mobileMenuOverlay;
    const hamburgerLines = menuButton.querySelectorAll(".hamburger-line");
    const navLinks = menu.querySelectorAll(".mobile-nav-link");

    let isOpen = false;

    function openMenu() {
      isOpen = true;
      menuButton.setAttribute("aria-expanded", "true");
      menuButton.setAttribute("aria-label", "סגור תפריט ניווט");

      // Animate hamburger to X
      if (hamburgerLines && hamburgerLines.length === 3) {
        (hamburgerLines[0] as HTMLElement).style.transform = "rotate(45deg)";
        (hamburgerLines[1] as HTMLElement).style.opacity = "0";
        (hamburgerLines[2] as HTMLElement).style.transform = "rotate(-45deg)";
      }

      // Show overlay
      overlay.classList.remove("pointer-events-none");
      overlay.classList.add("pointer-events-auto");
      overlay.style.opacity = "1";

      // Show menu with slide animation
      menu.classList.remove("invisible");
      menu.style.opacity = "1";
      menu.style.transform = "translateY(0)";

      // Animate nav links with stagger
      navLinks?.forEach((link, index) => {
        setTimeout(
          () => {
            (link as HTMLElement).style.opacity = "1";
            (link as HTMLElement).style.transform = "translateX(0)";
          },
          50 + index * 50
        );
      });

      // Prevent body scroll (scrollbar-gutter: stable in CSS prevents layout shift)
      document.body.style.overflow = "hidden";
    }

    function closeMenu() {
      isOpen = false;
      menuButton.setAttribute("aria-expanded", "false");
      menuButton.setAttribute("aria-label", "פתח תפריט ניווט");

      // Animate X back to hamburger
      if (hamburgerLines && hamburgerLines.length === 3) {
        (hamburgerLines[0] as HTMLElement).style.transform = "translateY(-8px)";
        (hamburgerLines[1] as HTMLElement).style.opacity = "1";
        (hamburgerLines[2] as HTMLElement).style.transform = "translateY(8px)";
      }

      // Hide overlay
      overlay.style.opacity = "0";
      setTimeout(() => {
        overlay.classList.remove("pointer-events-auto");
        overlay.classList.add("pointer-events-none");
      }, 300);

      // Hide menu with slide animation
      menu.style.opacity = "0";
      menu.style.transform = "translateY(-8px)";
      setTimeout(() => {
        menu.classList.add("invisible");
      }, 300);

      // Reset nav links
      navLinks?.forEach((link) => {
        (link as HTMLElement).style.opacity = "0";
        (link as HTMLElement).style.transform = "translateX(16px)";
      });

      // Restore body scroll
      document.body.style.overflow = "";
    }

    function toggleMenu() {
      if (isOpen) {
        closeMenu();
      } else {
        openMenu();
      }
    }

    // Event listeners
    menuButton.addEventListener("click", toggleMenu);
    overlay.addEventListener("click", closeMenu);

    // Close menu on nav link click
    navLinks?.forEach((link) => {
      link.addEventListener("click", closeMenu);
    });

    // Close menu on Escape key
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && isOpen) {
        closeMenu();
      }
    });

    // Close menu on resize to desktop
    window.addEventListener("resize", () => {
      if (window.innerWidth >= 768 && isOpen) {
        closeMenu();
      }
    });
  }

  // Add padding to body to account for fixed header
  function initHeaderPadding() {
    const header = document.querySelector("header");
    if (header) {
      const headerHeight = header.offsetHeight;
      document.body.style.paddingTop = `${headerHeight}px`;
    }
  }

  // Initialize on page load
  document.addEventListener("DOMContentLoaded", () => {
    initTheme();
    initMobileMenu();
    initHeaderPadding();
  });

  // Re-initialize on Astro page transitions
  document.addEventListener("astro:page-load", () => {
    initTheme();
    initMobileMenu();
    initHeaderPadding();
  });
</script>
